{"version":3,"sources":["Chat.js","EmojiGroup.js","Lang.js","Resize.js","ScrollBar.js","Socket.js","WebRTC.js"],"names":["Chat","startStream","WebRTC","getMedia","log","Lang","get","stopStream","Socket","sendMessage","close","ws","this","localStream","classList","add","startBtn","innerText","started","localVideo","pause","src","stop","nextStream","refresh","textarea","value","clearHistory","history","innerHTML","fullScreen","e","view","document","querySelector","remove","fullscreenElement","msFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElemenz","exitFullscreen","msExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","documentElement","requestFullscreen","msRequestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","text","clear","pushMesage","author","message","div","createElement","span","twemoji","parse","autoLink","callback","url","linkContent","test","icon","appendChild","showNotification","scrollTop","scrollHeight","window","navigator","vibrate","audio","readyState","currentTime","play","Notification","hidden","permission","requestPermission","notification","body","onclick","focus","console","warn","getStreamSources","MediaStreamTrack","getSources","list","lists","video","option","optOnClick","constraints","dataset","kind","optional","sourceId","id","i","length","opt","label","childElementCount","flipBtn","toggle","sources","k","title","className","setSmiles","time","frag","createDocumentFragment","EmojiGroup","key","j","emoji","smile","split","join","strPos","selectionStart","substring","bind","smiles","timeEnd","onLoad","setLanguage","Audio","getElementById","remoteVideo","remoteStream","sendBtn","stopBtn","reportBtn","cameraInfo","addEventListener","event","keyCode","shiftKey","preventDefault","ScrollBar","set","ondblclick","target","init","Resize","dictionary","next","en","ru","start","report","log_start","log_get_stream","log_search","log_leave","log_next","log_clouse_conecting","log_clouse_disconected","log_socket_error","log_no_conection","log_stream_error","log_partner_conected","log_webrtc_error","camera-on","flip_video","smile_people","smile_nature","smile_food","smile_celebration","smile_activity","smile_travel","smile_objects","language","lang","userLanguage","translate","elements","querySelectorAll","contains","style","cursor","parentElement","clientWidth","clientHeight","xMouse","clientX","yMouse","clientY","ondragstart","onselectstart","webkitUserSelect","userSelect","width","height","videoHeight","videoWidth","innerHeight","undefined","orientation","boxs","ctns","bars","btns","onscroll","scroll","overflowY","startWidth","scrollWidth","n","alpha","top","create","WebSocket","location","origin","replace","onOpen","onMessage","onClose","onError","info","interval","setInterval","JSON","data","type","content","createOffer","clearInterval","wasClean","mute","send","stringify","PeerConnection","mozRTCPeerConnection","webkitRTCPeerConnection","IceCandidate","mozRTCIceCandidate","RTCIceCandidate","SessionDescription","mozRTCSessionDescription","RTCSessionDescription","servers","pc","addStream","onicecandidate","getIceCandidate","onaddstream","getRemoteStream","getUserMedia","mozGetUserMedia","webkitGetUserMedia","getLocalStream","streamError","stream","URL","createObjectURL","getStream","setTimeout","getError","gotLocalDescription","description","setLocalDescription","candidate","sdpMLineIndex","sdpMid","mandatory","OfferToReceiveAudio","OfferToReceiveVideo","createAnswer","setRemoteDescription","addIceCandidate"],"mappings":"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AAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,OAAA,QAAA,QAAA,QAAA,QACA,QAAA,OAAA,QAAA,OAAA,OAAA,QAAA,QAAA,WAGAF,IAAA,SACAE,OACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,OAAA,QACA,QAAA,OAAA,OAAA,OAAA,QAAA,QAAA,OAAA,QACA,OAAA,QAAA,OAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,WAGAF,IAAA,OACAE,OACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,OAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,WAGAF,IAAA,cACAE,OACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,OAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,OAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,WAGAF,IAAA,WACAE,OACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,OAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,OAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,WAGAF,IAAA,SACAE,OACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,OACA,QAAA,QAAA,QAAA,QAAA,QAAA,OAAA,QAAA,OACA,QAAA,QAAA,OAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,OAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,OAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,cAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,cAAA,cAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,cACA,cAAA,cAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,cAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,cAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,cAAA,cAAA,QAAA,QACA,QAAA,WAGAF,IAAA,UACAE,OACA,OAAA,QAAA,QAAA,QAAA,OAAA,OAAA,OAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,OAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,OAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,OAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,OAAA,OAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,OAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,OAAA,OAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,OAAA,OAAA,OAAA,OACA,OAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QAAA,QACA,QAAA,QAAA,QAAA,QAAA,OAAA,OAAA,OAAA,OACA,OAAA,OAAA,OAAA,OAAA,OAAA,OAAA,OAAA,OACA,QAAA,QAAA,QAAA,QAAA,OAAA,QAAA,QAAA,QACA,OAAA,OAAA,QAAA,QAAA,OAAA,OAAA,OAAA,OACA,OAAA,OAAA,OAAA,OAAA,OAAA,OAAA,OAAA,OACA,OAAA,OAAA,QAAA,OAAA,OAAA,OAAA,OAAA,QACA,QAAA,QAAA,UAAA,UAAA,UAAA,UAAA,UAAA,UACA,UAAA,UAAA,UAAA,UAAA,UAAA,QAAA,QAAA,QACA,QAAA,QAAA,OAAA,QAAA,QAAA,QAAA,OAAA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","file":"main.js","sourcesContent":["/* globals WebRTC, Socket, twemoji, ScrollBar, Resize, Lang, EmojiGroup */\r\n\r\nvar Chat = {};\r\n\r\nChat.startStream = function() {\r\n    WebRTC.getMedia();\r\n    Chat.log(Lang.get('log_get_stream'));\r\n};\r\n\r\nChat.stopStream = function() {\r\n    Socket.sendMessage('stop');\r\n    WebRTC.close();\r\n    Socket.ws.close();\r\n    this.localStream.classList.add('camera-off');\r\n    this.startBtn.innerText = Lang.get('start');\r\n    this.started = false;\r\n\r\n    this.localVideo.pause();\r\n    this.localVideo.src = '';\r\n    WebRTC.localStream.stop();\r\n};\r\n\r\nChat.nextStream = function() {\r\n    Chat.log(Lang.get('log_search'));\r\n    WebRTC.refresh();\r\n    Socket.sendMessage('next');\r\n};\r\n\r\nChat.sendMessage = function() {\r\n    Socket.sendMessage('message', Chat.textarea.value);\r\n    Chat.textarea.value = '';\r\n};\r\n\r\nChat.clearHistory = function() {\r\n    Chat.history.innerHTML = '';\r\n};\r\n\r\nChat.fullScreen = function() {\r\n    var e;\r\n    var view =  document.querySelector('.view');\r\n    document.querySelector('.stream-bar').classList.remove('big');\r\n    if (document.fullscreenElement ||\r\n        document.msFullscreenElement ||\r\n        document.webkitCurrentFullScreenElement ||\r\n        document.mozFullScreenElemenz\r\n    ) {\r\n        e = document;\r\n        if (e.exitFullscreen) {\r\n            e.exitFullscreen();\r\n        } else if (e.msExitFullscreen) {\r\n            e.msExitFullscreen();\r\n        } else if (e.webkitCancelFullScreen) {\r\n            e.webkitCancelFullScreen();\r\n        } else if (e.mozCancelFullScreen) {\r\n            e.mozCancelFullScreen();\r\n        }\r\n\r\n        view.classList.remove('fullscreen');\r\n    } else {\r\n        e = document.documentElement;\r\n        if (e.requestFullscreen) {\r\n            e.requestFullscreen();\r\n        } else if (e.msRequestFullscreen) {\r\n            e.msRequestFullscreen();\r\n        } else if (e.webkitRequestFullScreen) {\r\n            e.webkitRequestFullScreen();\r\n        } else if (e.mozRequestFullScreen) {\r\n            e.mozRequestFullScreen();\r\n        }\r\n        view.classList.add('fullscreen');\r\n    }\r\n};\r\n\r\nChat.log = function(text, clear) {\r\n    if (clear) {\r\n        this.clearHistory();\r\n    }\r\n    this.pushMesage({\r\n        text: text,\r\n        author: 'system'\r\n    });\r\n};\r\n\r\nChat.pushMesage = function(message) {\r\n    var div = document.createElement('div');\r\n    var span = document.createElement('span');\r\n    span.innerText = message.text;\r\n\r\n    span.innerHTML = twemoji.parse(span.innerText.autoLink({\r\n        callback: function(url) {\r\n            var linkContent = /\\.(gif|png|jpe?g)$/i.test(url) ? '<img src=\"' + url + '\">' : url;\r\n            return '<a target=\"_blank\" class=\"image\" href=\"' + url + '\">' + linkContent + '</a>';\r\n        }\r\n    }), function(icon) {\r\n        return 'https://twemoji.maxcdn.com/svg/' + icon + '.svg';\r\n    });\r\n\r\n    div.classList.add('message');\r\n    div.classList.add(message.author);\r\n    div.appendChild(span);\r\n    Chat.history.appendChild(div);\r\n\r\n    if (message.author == 'partner') {\r\n        Chat.showNotification(message.text);\r\n    }\r\n    Chat.history.scrollTop = Chat.history.scrollHeight;\r\n};\r\n\r\nChat.showNotification = function(text) {\r\n    if (window.navigator.vibrate) {\r\n        window.navigator.vibrate(100);\r\n    }\r\n\r\n    if (this.audio.readyState == 4) {\r\n        this.audio.currentTime = 0;\r\n        this.audio.play();\r\n    }\r\n\r\n    if (!Notification || document.hidden == 'undefined') {\r\n        console.warn('Notification not supported');\r\n    } else if (Notification.permission != 'granted') {\r\n        Notification.requestPermission();\r\n    }else if (Notification.permission == 'granted' && document.hidden) {\r\n        var notification = new Notification('RuletkaJS', {\r\n            body: text,\r\n            icon: '/img/icon_192.png'\r\n        });\r\n        notification.onclick = function() {\r\n            window.focus();\r\n        };\r\n    }\r\n};\r\n\r\nChat.getStreamSources = function() {\r\n    if (window.MediaStreamTrack) {\r\n        window.MediaStreamTrack.getSources(function(list) {\r\n            var lists = {\r\n                'audio': document.createElement('ul'),\r\n                'video': document.createElement('ul'),\r\n                'option': document.createElement('ul')\r\n            };\r\n\r\n            var optOnClick = function() {\r\n                WebRTC.constraints[this.dataset.kind] = {\r\n                    optional: [{sourceId: this.dataset.id}]\r\n                };\r\n                console.log(this.value, WebRTC.constraints);\r\n            };\r\n\r\n            for (var i = 0; i < list.length; i++) {\r\n                var opt = document.createElement('li');\r\n                opt.innerText = list[i].label || list[i].kind + ' ' + (lists[list[i].kind].childElementCount + 1);\r\n                opt.dataset.id = list[i].id;\r\n                opt.dataset.kind = list[i].kind;\r\n                lists[list[i].kind].appendChild(opt);\r\n                opt.onclick = optOnClick;\r\n            }\r\n\r\n            var flipBtn = document.createElement('li');\r\n            flipBtn.innerText = Lang.get('flip_video');\r\n            flipBtn.onclick = function() {\r\n                Chat.localVideo.classList.toggle('flip');\r\n            };\r\n            lists.option.appendChild(flipBtn);\r\n\r\n            Chat.sources.innerHTML = '';\r\n            for (var k in lists) {\r\n                var title = document.createElement('div');\r\n                title.className = 'title';\r\n                title.innerText = Lang.get(k);\r\n                Chat.sources.appendChild(title);\r\n                Chat.sources.appendChild(lists[k]);\r\n            }\r\n        });\r\n    }\r\n};\r\n\r\nChat.setSmiles = function() {\r\n    console.time('smile');\r\n    var frag = document.createDocumentFragment();\r\n    for (var i = 0; i < EmojiGroup.length; i++) {\r\n        var title = document.createElement('div');\r\n        title.className = 'title';\r\n        title.innerText = Lang.get('smile_' + EmojiGroup[i].key);\r\n        frag.appendChild(title);\r\n\r\n        for (var j = 0; j < EmojiGroup[i].emoji.length; j++) {\r\n            var smile = document.createElement('div');\r\n            smile.className = 'smile';\r\n            smile.innerHTML = '&#x' + EmojiGroup[i].emoji[j].split('-').join(';&#x') + ';';\r\n            smile.onclick = function() {\r\n                Chat.textarea.focus();\r\n                var strPos = Chat.textarea.selectionStart;\r\n                Chat.textarea.value = (Chat.textarea.value).substring(0,strPos) + this +\r\n                (Chat.textarea.value).substring(strPos,Chat.textarea.value.length);\r\n            }.bind(smile.innerHTML);\r\n            frag.appendChild(smile);\r\n        }\r\n    }\r\n    twemoji.parse(frag, {callback: function(icon) {\r\n        return 'https://twemoji.maxcdn.com/svg/' + icon + '.svg';\r\n    }});\r\n    Chat.smiles.appendChild(frag);\r\n    console.timeEnd('smile');\r\n};\r\n\r\nChat.onLoad = function() {\r\n    Lang.setLanguage();\r\n    this.started = false;\r\n\r\n    this.audio = new Audio('notification.mp3');\r\n    this.history = document.getElementById('history');\r\n    this.sources = document.getElementById('sources');\r\n    this.textarea = document.getElementById('textarea');\r\n\r\n    this.localVideo = document.getElementById('localVideo');\r\n    this.remoteVideo = document.getElementById('remoteVideo');\r\n\r\n    this.localStream = document.getElementById('localStream');\r\n    this.remoteStream = document.getElementById('remoteStream');\r\n    this.sendBtn = document.querySelector('.submit-btn');\r\n\r\n    this.startBtn = document.getElementById('start-btn');\r\n    this.stopBtn = document.getElementById('stop-btn');\r\n    this.reportBtn = document.getElementById('report-btn');\r\n\r\n    this.cameraInfo = document.getElementById('camera-info');\r\n    this.cameraInfo.innerText = Lang.get('camera-on');\r\n\r\n    this.smiles = document.querySelector('.smile-picker .scroll-content');\r\n\r\n    this.sendBtn.addEventListener('click', Chat.sendMessage);\r\n\r\n    this.textarea.addEventListener('keydown', function(event) {\r\n        if (event.keyCode == 13 && !event.shiftKey) {\r\n            event.preventDefault();\r\n            Chat.sendMessage();\r\n        }\r\n    });\r\n\r\n    this.startBtn.addEventListener('click', function() {\r\n        if (Chat.started) {\r\n            Chat.nextStream();\r\n        } else {\r\n            Chat.startStream();\r\n        }\r\n    });\r\n\r\n    this.stopBtn.addEventListener('click', function() {\r\n        if (Chat.started) {\r\n            Chat.stopStream();\r\n        }\r\n    });\r\n\r\n    this.startBtn.innerText = Lang.get('start');\r\n    this.stopBtn.innerText = Lang.get('stop');\r\n    this.reportBtn.innerText = Lang.get('report');\r\n\r\n    this.getStreamSources();\r\n\r\n    document.querySelector('.switch').onclick = function() {\r\n        var view = document.querySelector('.view');\r\n        view.classList.toggle('streams');\r\n        view.classList.toggle('chat');\r\n        ScrollBar.set();\r\n    };\r\n\r\n    document.querySelector('video').ondblclick = function() {\r\n        Chat.fullScreen();\r\n    };\r\n\r\n    document.querySelector('.option-btn').onclick = function() {\r\n        document.querySelector('.option-menu').classList.toggle('visible');\r\n    };\r\n\r\n    document.querySelector('.smile-btn').onclick = function() {\r\n        document.querySelector('.smile-picker').classList.toggle('visible');\r\n    };\r\n\r\n    document.querySelector('.smile-picker').addEventListener('click', function() {\r\n        this.classList.add('visible');\r\n    });\r\n\r\n    document.body.addEventListener('click', function(e) {\r\n        if (\r\n            e.target != document.querySelector('.option-btn') &&\r\n            e.target != document.querySelector('.smile-btn')\r\n        ) {\r\n            document.querySelector('.smile-picker').classList.remove('visible');\r\n            document.querySelector('.option-menu').classList.remove('visible');\r\n        }\r\n    }, true);\r\n\r\n    Chat.setSmiles();\r\n    ScrollBar.init();\r\n    Resize.init();\r\n    Chat.log(Lang.get('log_start'));\r\n};\r\n\r\nwindow.addEventListener('load', Chat.onLoad.bind(Chat));\r\n","var EmojiGroup = [\r\n    {\r\n        key: 'people',\r\n        emoji: [\r\n            '1f600', '1f601', '1f602', '1f603', '1f604', '1f605', '1f606', '1f607',\r\n            '1f608', '1f47f', '1f609', '1f60a', '263a',  '1f60b', '1f60c', '1f60d',\r\n            '1f60e', '1f60f', '1f610', '1f611', '1f612', '1f613', '1f614', '1f615',\r\n            '1f616', '1f617', '1f618', '1f619', '1f61a', '1f61b', '1f61c', '1f61d',\r\n            '1f61e', '1f61f', '1f620', '1f621', '1f622', '1f623', '1f624', '1f625',\r\n            '1f626', '1f627', '1f628', '1f629', '1f62a', '1f62b', '1f62c', '1f62d',\r\n            '1f62e', '1f62f', '1f630', '1f631', '1f632', '1f633', '1f634', '1f635',\r\n            '1f636', '1f637', '1f638', '1f639', '1f63a', '1f63b', '1f63c', '1f63d',\r\n            '1f63e', '1f63f', '1f640', '1f463', '1f464', '1f465', '1f476', '1f466',\r\n            '1f467', '1f468', '1f469', '1f46a', '1f468', '1f469', '1f467', '1f468',\r\n            '1f469', '1f467', '1f466', '1f468', '1f469', '1f466', '1f466', '1f468',\r\n            '1f469', '1f467', '1f467', '1f469', '1f469', '1f466', '1f469', '1f469',\r\n            '1f467', '1f469', '1f469', '1f467', '1f466', '1f469', '1f469', '1f466',\r\n            '1f466', '1f469', '1f469', '1f467', '1f467', '1f468', '1f468', '1f466',\r\n            '1f468', '1f468', '1f467', '1f468', '1f468', '1f467', '1f466', '1f468',\r\n            '1f468', '1f466', '1f466', '1f468', '1f468', '1f467', '1f467', '1f46b',\r\n            '1f46c', '1f46d', '1f46f', '1f470', '1f471', '1f472', '1f473', '1f474',\r\n            '1f475', '1f46e', '1f477', '1f478', '1f482', '1f47c', '1f385', '1f47b',\r\n            '1f479', '1f47a', '1f4a9', '1f480', '1f47d', '1f47e', '1f647', '1f481',\r\n            '1f645', '1f646', '1f64b', '1f64e', '1f64d', '1f486', '1f487', '1f491',\r\n            '1f469', '2764',  '1f469', '1f468', '2764',  '1f468', '1f48f', '1f469',\r\n            '2764',  '1f48b', '1f469', '1f468', '2764',  '1f48b', '1f468', '1f64c',\r\n            '1f44f', '1f442', '1f440', '1f443', '1f444', '1f48b', '1f445', '1f485',\r\n            '1f44b', '1f44d', '1f44e', '261d',  '1f446', '1f447', '1f448', '1f449',\r\n            '1f44c', '270c',  '1f44a',  '270a', '270b',  '1f4aa', '1f450', '1f64f'\r\n        ]\r\n    },{\r\n        key: 'nature',\r\n        emoji: [\r\n            '1f331', '1f332', '1f333', '1f334', '1f335', '1f337', '1f338', '1f339',\r\n            '1f33a', '1f33b', '1f33c', '1f490', '1f33e', '1f33f', '1f340', '1f341',\r\n            '1f342', '1f343', '1f344', '1f330', '1f400', '1f401', '1f42d', '1f439',\r\n            '1f402', '1f403', '1f404', '1f42e', '1f405', '1f406', '1f42f', '1f407',\r\n            '1f430', '1f408', '1f431', '1f40e', '1f434', '1f40f', '1f411', '1f410',\r\n            '1f413', '1f414', '1f424', '1f423', '1f425', '1f426', '1f427', '1f418',\r\n            '1f42a', '1f42b', '1f417', '1f416', '1f437', '1f43d', '1f415', '1f429',\r\n            '1f436', '1f43a', '1f43b', '1f428', '1f43c', '1f435', '1f648', '1f649',\r\n            '1f64a', '1f412', '1f409', '1f432', '1f40a', '1f40d', '1f422', '1f438',\r\n            '1f40b', '1f433', '1f42c', '1f419', '1f41f', '1f420', '1f421', '1f41a',\r\n            '1f40c', '1f41b', '1f41c', '1f41d', '1f41e', '1f43e', '26a1',  '1f525',\r\n            '1f319', '2600',  '26c5',  '2601',  '1f4a7', '1f4a6', '2614',  '1f4a8',\r\n            '2744',  '1f31f', '2b50',  '1f320', '1f304', '1f305', '1f308', '1f30a',\r\n            '1f30b', '1f30c', '1f5fb', '1f5fe', '1f310', '1f30d', '1f30e', '1f30f',\r\n            '1f311', '1f312', '1f313', '1f314', '1f315', '1f316', '1f317', '1f318',\r\n            '1f31a', '1f31d', '1f31b', '1f31c', '1f31e'\r\n        ]\r\n    },{\r\n        key: 'food',\r\n        emoji: [\r\n            '1f345', '1f346', '1f33d', '1f360', '1f347', '1f348', '1f349', '1f34a',\r\n            '1f34b', '1f34c', '1f34d', '1f34e', '1f34f', '1f350', '1f351', '1f352',\r\n            '1f353', '1f354', '1f355', '1f356', '1f357', '1f358', '1f359', '1f35a',\r\n            '1f35b', '1f35c', '1f35d', '1f35e', '1f35f', '1f361', '1f362', '1f363',\r\n            '1f364', '1f365', '1f366', '1f367', '1f368', '1f369', '1f36a', '1f36b',\r\n            '1f36c', '1f36d', '1f36e', '1f36f', '1f370', '1f371', '1f372', '1f373',\r\n            '1f374', '1f375', '2615', '1f376', '1f377',  '1f378', '1f379', '1f37a',\r\n            '1f37b', '1f37c'\r\n        ]\r\n    },{\r\n        key: 'celebration',\r\n        emoji: [\r\n            '1f380', '1f381', '1f382', '1f383', '1f384', '1f38b', '1f38d', '1f391',\r\n            '1f386', '1f387', '1f389', '1f38a', '1f388', '1f4ab', '2728',  '1f4a5',\r\n            '1f393', '1f451', '1f38e', '1f38f', '1f390', '1f38c', '1f38c', '1f3ee',\r\n            '1f48d', '2764',  '1f494', '1f48c', '1f495', '1f49e', '1f493', '1f497',\r\n            '1f496', '1f498', '1f49d', '1f49f', '1f49c', '1f49b', '1f49a', '1f499'\r\n        ]\r\n    },{\r\n        key: 'activity',\r\n        emoji: [\r\n            '1f380', '1f381', '1f382', '1f383', '1f384', '1f38b', '1f38d', '1f391',\r\n            '1f386', '1f387', '1f389', '1f38a', '1f388', '1f4ab', '2728',  '1f4a5',\r\n            '1f393', '1f451', '1f38e', '1f38f', '1f390', '1f38c', '1f38c', '1f3ee',\r\n            '1f48d', '2764', '1f494',  '1f48c', '1f495', '1f49e', '1f493', '1f497',\r\n            '1f496', '1f498', '1f49d', '1f49f', '1f49c', '1f49b', '1f49a', '1f499'\r\n        ]\r\n    },{\r\n        key: 'travel',\r\n        emoji: [\r\n            '1f683', '1f69e', '1f682', '1f68b', '1f69d', '1f684', '1f685', '1f686',\r\n            '1f687', '1f688', '1f689', '1f68a', '1f68c', '1f68d', '1f68e', '1f690',\r\n            '1f691', '1f692', '1f693', '1f694', '1f6a8', '1f695', '1f696', '1f697',\r\n            '1f698', '1f699', '1f69a', '1f69b', '1f69c', '1f6b2', '1f68f', '26fd',\r\n            '1f6a7', '1f6a6', '1f6a5', '1f680', '1f681', '2708',  '1f4ba', '2693',\r\n            '1f6a2', '1f6a4', '26f5',  '1f6a1', '1f6a0', '1f69f', '1f6c2', '1f6c3',\r\n            '1f6c4', '1f6c5', '1f4b4', '1f4b6', '1f4b7', '1f4b5', '1f5fd', '1f5ff',\r\n            '1f301', '1f5fc', '26f2',  '1f3f0', '1f3ef', '1f307', '1f306', '1f303',\r\n            '1f309', '1f3e0', '1f3e1', '1f3e2', '1f3ec', '1f3ed', '1f3e3', '1f3e4',\r\n            '1f3e5', '1f3e6', '1f3e8', '1f3e9', '1f492', '26ea',  '1f3ea', '1f3eb',\r\n            '1f1e6', '1f1fa', '1f1e6', '1f1f9', '1f1e7', '1f1ea', '1f1e7', '1f1f7',\r\n            '1f1e8', '1f1e6', '1f1e8', '1f1f1', '1f1e8-1f1f3',    '1f1e8', '1f1f4', '1f1e9',\r\n            '1f1f0', '1f1eb', '1f1ee', '1f1eb-1f1f7',    '1f1e9-1f1ea','1f1ed', '1f1f0', '1f1ee',\r\n            '1f1f3', '1f1ee', '1f1e9', '1f1ee', '1f1ea', '1f1ee', '1f1f1', '1f1ee-1f1f9',\r\n            '1f1ef-1f1f5', '1f1f0-1f1f7', '1f1f2', '1f1f4', '1f1f2', '1f1fe', '1f1f2', '1f1fd',\r\n            '1f1f3', '1f1f1', '1f1f3', '1f1ff', '1f1f3', '1f1f4', '1f1f5', '1f1ed',\r\n            '1f1f5', '1f1f1', '1f1f5', '1f1f9', '1f1f5', '1f1f7', '1f1f7-1f1fa', '1f1f8',\r\n            '1f1e6', '1f1f8', '1f1ec', '1f1ff', '1f1e6', '1f1ea-1f1f8', '1f1f8', '1f1ea',\r\n            '1f1e8', '1f1ed', '1f1f9', '1f1f7', '1f1ec-1f1e7', '1f1fa-1f1f8', '1f1e6', '1f1ea',\r\n            '1f1fb', '1f1f3'\r\n        ]\r\n    },{\r\n        key: 'objects',\r\n        emoji: [\r\n            '231a',  '1f4f1', '1f4f2', '1f4bb', '23f0',  '23f3',  '231b',  '1f4f7',\r\n            '1f4f9', '1f3a5', '1f4fa', '1f4fb', '1f4df', '1f4de', '260e',  '1f4e0',\r\n            '1f4bd', '1f4be', '1f4bf', '1f4c0', '1f4fc', '1f50b', '1f50c', '1f4a1',\r\n            '1f526', '1f4e1', '1f4b3', '1f4b8', '1f4b0', '1f48e', '1f302', '1f45d',\r\n            '1f45b', '1f45c', '1f4bc', '1f392', '1f484', '1f453', '1f452', '1f461',\r\n            '1f460', '1f462', '1f45e', '1f45f', '1f459', '1f457', '1f458', '1f45a',\r\n            '1f455', '1f454', '1f456', '1f6aa', '1f6bf', '1f6c1', '1f6bd', '1f488',\r\n            '1f489', '1f48a', '1f52c', '1f52d', '1f52e', '1f527', '1f52a', '1f529',\r\n            '1f528', '1f4a3', '1f6ac', '1f52b', '1f516', '1f4f0', '1f529', '1f528',\r\n            '1f4a3', '1f6ac', '1f52b', '1f516', '1f4f0', '1f511', '2709',  '1f4e9',\r\n            '1f4e8', '1f4e7', '1f4e5', '1f4e4', '1f4e6', '1f4ef', '1f4ee', '1f4ea',\r\n            '1f4eb', '1f4ec', '1f4ed', '1f4c4', '1f4c3', '1f4d1', '1f4c8', '1f4c9',\r\n            '1f4ca', '1f4c5', '1f4c6', '1f505', '1f506', '1f4dc', '1f4cb', '1f4d6',\r\n            '1f4d3', '1f4d4', '1f4d2', '1f4d5', '1f4d7', '1f4d8', '1f4d9', '1f4da',\r\n            '1f4c7', '1f517', '1f4ce', '1f4cc', '2702',  '1f4d0', '1f4cd', '1f4cf',\r\n            '1f6a9', '1f4c1', '1f4c2', '2712',  '270f',  '1f4dd', '1f50f', '1f510',\r\n            '1f512', '1f513', '1f4e3', '1f4e2', '1f508', '1f509', '1f50a', '1f507',\r\n            '1f4a4', '1f514', '1f515', '1f4ad', '1f4ac', '1f6b8', '1f50d', '1f50e',\r\n            '1f6ab', '26d4',  '1f4db', '1f6b7', '1f6af', '1f6b3', '1f6b1', '1f4f5',\r\n            '1f51e', '1f251', '1f250', '1f4ae', '3299',  '3297',  '1f234', '1f235',\r\n            '1f232', '1f236', '1f21a', '1f238', '1f23a', '1f237', '1f239', '1f233',\r\n            '1f202', '1f201', '1f22f', '1f4b9', '2747',  '2733',  '274e',  '2705',\r\n            '2734',  '1f4f3', '1f4f4', '1f19a', '1f170', '1f171', '1f18e', '1f191',\r\n            '1f17e', '1f198', '1f194', '1f17f', '1f6be', '1f192', '1f193', '1f195',\r\n            '1f196', '1f197', '1f199', '1f3e7', '2648', '2649', '264a', '264b',\r\n            '264c',  '264d',  '264e',  '264f', '2650', '2651', '2652', '2653',\r\n            '1f6bb', '1f6b9', '1f6ba', '1f6bc', '267f', '1f6b0', '1f6ad', '1f6ae',\r\n            '25b6',  '25c0',  '1f53c', '1f53d', '23e9', '23ea', '23eb', '23ec',\r\n            '27a1',  '2b05',  '2b06',  '2b07', '2197', '2198', '2199', '2196',\r\n            '2195',  '2194',  '1f504', '21aa', '21a9', '2934', '2935', '1f500',\r\n            '1f501', '1f502',  '23-20e3', '30-20e3', '31-20e3', '32-20e3', '33-20e3', '34-20e3',\r\n            '35-20e3', '36-20e3', '37-20e3', '38-20e3', '39-20e3', '1f51f', '1f522', '1f524',\r\n            '1f521', '1f520', '2139',  '1f4f6', '1f3a6', '1f523', '2795', '2796',\r\n            '3030',  '2797',  '2716',  '2714', '1f503', '2122', 'a9', 'ae',\r\n            '1f4b1', '1f4b2', '27b0',  '27bf', '303d', '2757', '2753', '2755',\r\n            '2754',  '203c',  '2049',  '274c', '2b55', '1f4af', '1f51a', '1f519',\r\n            '1f51b', '1f51d', '1f51c', '1f300', '24c2', '26ce', '1f52f', '1f530',\r\n            '1f531', '26a0',  '2668',  '267b', '1f4a2', '1f4a0', '2660', '2663',\r\n            '2665',  '2666',  '2611',  '26aa', '26ab', '1f518', '1f534', '1f535',\r\n            '1f53a', '1f53b', '1f538', '1f539', '1f536', '1f537', '25aa', '25ab',\r\n            '2b1b',  '2b1c',  '25fc',  '25fb', '25fe', '25fd', '1f532', '1f533',\r\n            '1f550', '1f551', '1f552', '1f553', '1f554', '1f555', '1f556', '1f557',\r\n            '1f558', '1f559', '1f55a', '1f55b', '1f55c', '1f55d', '1f55e', '1f55f',\r\n            '1f560', '1f561', '1f562', '1f563', '1f564', '1f565'\r\n        ]\r\n    }\r\n];\r\n","var Lang = {};\r\n\r\n/**\r\n * Язык по умолчанию, он будет выбран,\r\n * если в словаре нет нужного языка.\r\n *\r\n * @type {String}\r\n */\r\nLang.default = 'en';\r\n\r\n/**\r\n * Словарь враз на нескольких языхах\r\n * коды языков ISO 639-1\r\n *\r\n * @type {Object}\r\n */\r\nLang.dictionary = {\r\n    'next': {\r\n        'en': 'Next',\r\n        'ru': 'Далее'\r\n    },\r\n    'stop': {\r\n        'en': 'Stop',\r\n        'ru': 'Стоп'\r\n    },\r\n    'start': {\r\n        'en': 'Start',\r\n        'ru': 'Старт'\r\n    },\r\n    'audio': {\r\n        'en': 'Audio',\r\n        'ru': 'Аудио'\r\n    },\r\n    'video': {\r\n        'en': 'Video',\r\n        'ru': 'Видео'\r\n    },\r\n    'option': {\r\n        'en': 'Option',\r\n        'ru': 'Опции'\r\n    },\r\n    'report': {\r\n        'en': 'Report abuse',\r\n        'ru': 'Сообщить о нарушении'\r\n    },\r\n    'log_start': {\r\n        'en': 'Click \"Start\" to start a video chat with a random person.',\r\n        'ru': 'Нажмите кнопку «Старт», чтобы начать видеочат с случайным человеком.'\r\n    },\r\n    'log_get_stream': {\r\n        'en': 'Allow this site to use your camera.',\r\n        'ru': 'Разрешите этому сайту использовать вашу камеру.'\r\n    },\r\n    'log_search': {\r\n        'en': 'Search companion...',\r\n        'ru': 'Идет поиск собеседника...'\r\n    },\r\n    'log_leave': {\r\n        'en': 'The caller left a chat.',\r\n        'ru': 'Ваш собеседник покинул видеочат.'\r\n    },\r\n    'log_next': {\r\n        'en': 'The caller clicked \"Next\"',\r\n        'ru': 'Ваш собеседник нажал «Далее»'\r\n    },\r\n    'log_clouse_conecting': {\r\n        'en': 'Clouse conecting.',\r\n        'ru': 'Вы отключились от сервера.'\r\n    },\r\n    'log_clouse_disconected': {\r\n        'en': 'Server disconected.',\r\n        'ru': 'Соединение с сервером разорвано.'\r\n    },\r\n    'log_socket_error': {\r\n        'en': 'Socket Error.',\r\n        'ru': 'Ошибка Socket соединения'\r\n    },\r\n    'log_no_conection': {\r\n        'en': 'Server not connected',\r\n        'ru': 'Соединение с сервером не установлено'\r\n    },\r\n    'log_stream_error': {\r\n        'en': 'Stream error, you need access to the camera',\r\n        'ru': 'Ошибка получения потока, необходим доступ к камере'\r\n    },\r\n    'log_partner_conected': {\r\n        'en': 'The connection is established with the interlocutor.',\r\n        'ru': 'Соединение с собеседником установлено.'\r\n    },\r\n    'log_webrtc_error': {\r\n        'en': 'WebRTC Error',\r\n        'ru': 'Ошибка WebRTC'\r\n    },\r\n    'camera-on': {\r\n        'en': 'Turn on the camera',\r\n        'ru': 'Включите камеру'\r\n    },\r\n    'flip_video': {\r\n        'en': 'Flip video',\r\n        'ru': 'Отразить видео'\r\n    },\r\n    'smile_people': {\r\n        'en': 'People',\r\n        'ru': 'Люди'\r\n    },\r\n    'smile_nature': {\r\n        'en': 'Nature',\r\n        'ru': 'Природа'\r\n    },\r\n    'smile_food': {\r\n        'en': 'Food & Drink',\r\n        'ru': 'Еда и Напитки'\r\n    },\r\n    'smile_celebration': {\r\n        'en': 'Celebration',\r\n        'ru': 'Праздник'\r\n    },\r\n    'smile_activity': {\r\n        'en': 'Activity',\r\n        'ru': 'Мероприятия'\r\n    },\r\n    'smile_travel': {\r\n        'en': 'Travel & Places',\r\n        'ru': 'Путешествия и Места'\r\n    },\r\n    'smile_objects': {\r\n        'en': 'Objects & Symbols',\r\n        'ru': 'Объекты и Символы'\r\n    }\r\n};\r\n\r\n/**\r\n * Устанавливает язык на тот, что указан в первом параметре,\r\n * или из тега <html lang>,\r\n * или navigator.language\r\n * или navigator.userLanguage (EI)\r\n * или на русский \"ru\"\r\n *\r\n * @param {String} language ISO 639-1 Код языка\r\n * @return {String} Возвращает ISO 639-1 код установленного языка\r\n */\r\nLang.setLanguage = function(language) {\r\n    this.language = (\r\n        language                      ||\r\n        document.documentElement.lang ||\r\n        navigator.language            ||\r\n        navigator.userLanguage        ||\r\n        this.default\r\n    ).split('-')[0];\r\n\r\n    return this.language;\r\n};\r\n\r\n/**\r\n * Преобразует Языковой объект во вразу установленного языка.\r\n * Если фразы нужного языка нет, то возвращает враузу языка по умолчанию.\r\n * Если передан не объект, то возвращает его без преобразований.\r\n *\r\n * @param  {Object} value Языковой объект или строка\r\n * @return {String}       Фразу установленного языка\r\n */\r\nLang.translate = function(value) {\r\n    if (typeof value === 'object') {\r\n        return value[this.language] || value[this.default];\r\n    } else {\r\n        return value;\r\n    }\r\n};\r\n\r\n/**\r\n * Возвращает фразу по ключу из словаря\r\n *\r\n * @param  {String} key Ключ фразы в словаре\r\n * @return {String}     Фраза из словаря\r\n */\r\nLang.get = function(key) {\r\n    if (Lang.dictionary[key]) {\r\n        return this.translate(this.dictionary[key]);\r\n    } else {\r\n        return '[' + key + ']';\r\n    }\r\n};\r\n","/* globals Chat, ScrollBar */\r\n\r\nvar Resize = {};\r\nResize.init = function() {\r\n    this.elements = document.querySelectorAll('.resize-line');\r\n    for (var i = 0; i < this.elements.length; i++) {\r\n        this.elements[i].addEventListener('dragstart', function() {\r\n            return false;\r\n        });\r\n        this.elements[i].addEventListener('mousedown', function(event) {\r\n            Resize.target = this;\r\n            if (this.classList.contains('vertical')) {\r\n                document.body.style.cursor = 'col-resize';\r\n                Resize.start = this.parentElement.clientWidth;\r\n            } else {\r\n                document.body.style.cursor = 'row-resize';\r\n                Resize.start = this.parentElement.clientHeight;\r\n            }\r\n            Resize.xMouse  = event.clientX;\r\n            Resize.yMouse  = event.clientY;\r\n            document.ondragstart = function() { return false };\r\n            document.body.onselectstart = function() { return false };\r\n            document.body.style.webkitUserSelect = document.body.style.userSelect = 'none';\r\n        });\r\n        window.addEventListener('mousemove', function(event) {\r\n            if (Resize.target) {\r\n                Resize.video();\r\n                if (Resize.target.classList.contains('vertical')) {\r\n                    Resize.target.parentElement.style.width = Resize.start + (event.clientX - Resize.xMouse) + 'px';\r\n                } else {\r\n                    Resize.target.parentElement.style.height = Resize.start + (Resize.yMouse - event.clientY) + 'px';\r\n                }\r\n            }\r\n        });\r\n        window.addEventListener('mouseup', function() {\r\n            Resize.target = false;\r\n            document.body.style.cursor = 'default';\r\n            document.ondragstart = null;\r\n            document.body.onselectstart = null;\r\n            document.body.style.webkitUserSelect = document.body.style.userSelect = '';\r\n        });\r\n    }\r\n};\r\n\r\nResize.video = function() {\r\n    var height = Chat.remoteVideo.clientHeight;\r\n\r\n    if (Chat.localVideo.videoHeight) {\r\n        height += Chat.remoteVideo.clientWidth * (Chat.localVideo.videoHeight / Chat.localVideo.videoWidth);\r\n    } else {\r\n        height += Chat.localVideo.clientHeight;\r\n    }\r\n\r\n    height += document.querySelector('.control-panel').clientHeight;\r\n\r\n    if (height + 40 > window.innerHeight - document.querySelector('.header').clientHeight &&\r\n        !document.querySelector('.view').classList.contains('fullscreen') &&\r\n        window.orientation == undefined\r\n    ) {\r\n        document.querySelector('.stream-bar').classList.add('big');\r\n    } else {\r\n        document.querySelector('.stream-bar').classList.remove('big');\r\n    }\r\n    ScrollBar.set();\r\n};\r\n","/* globals Resize */\r\n\r\nvar ScrollBar = {};\r\nScrollBar.init = function() {\r\n    this.boxs = document.querySelectorAll('.scroll-box');\r\n    this.ctns = document.querySelectorAll('.scroll-box .scroll-content');\r\n    this.bars = document.querySelectorAll('.scroll-box .scroll-bar');\r\n    this.btns = document.querySelectorAll('.scroll-box .scroll-btn');\r\n\r\n    for (var i = 0; i < this.ctns.length; i++) {\r\n        this.ctns[i].onscroll = function() {\r\n            ScrollBar.scroll(this);\r\n        }.bind(i);\r\n    }\r\n\r\n    window.addEventListener('resize', function() {\r\n        ScrollBar.set();\r\n        Resize.video();\r\n    });\r\n    this.set();\r\n};\r\n\r\nScrollBar.set = function() {\r\n    for (var i = 0; i < ScrollBar.boxs.length; i++) {\r\n        ScrollBar.bars[i].classList.remove('visible');\r\n        ScrollBar.ctns[i].style.width = '100%';\r\n        ScrollBar.ctns[i].style.overflowY = 'hidden';\r\n        var startWidth = ScrollBar.ctns[i].clientWidth;\r\n        ScrollBar.ctns[i].style.overflowY = 'scroll';\r\n        var scrollWidth = startWidth - ScrollBar.ctns[i].clientWidth;\r\n        ScrollBar.ctns[i].style.width = startWidth + scrollWidth + 'px';\r\n        ScrollBar.bars[i].classList.add('visible');\r\n        ScrollBar.scroll(i);\r\n    }\r\n};\r\n\r\nScrollBar.scroll = function(n) {\r\n    var alpha = this.ctns[n].clientHeight / this.ctns[n].scrollHeight;\r\n    this.btns[n].style.height = alpha * 100 + '%';\r\n    this.btns[n].style.top = this.ctns[n].scrollTop * alpha + 'px';\r\n};\r\n","/* globals WebRTC, Chat, Lang */\r\n\r\nvar Socket = {};\r\n\r\nSocket.create = function() {\r\n    if (!this.ws || this.ws.readyState != 1) {\r\n        this.ws = new WebSocket(location.origin.replace(/^http/, 'ws'));\r\n        this.ws.addEventListener('open', this.onOpen);\r\n        this.ws.addEventListener('message', this.onMessage);\r\n        this.ws.addEventListener('close', this.onClose);\r\n        this.ws.addEventListener('error', this.onError);\r\n    }\r\n};\r\n\r\nSocket.onOpen = function() {\r\n    console.info('WS connected.');\r\n    Chat.startBtn.innerText = Lang.get('next');\r\n    Chat.started = true;\r\n    Chat.interval = setInterval(function() {\r\n        Socket.sendMessage('ping', {}, true);\r\n    }, 5000);\r\n    Chat.nextStream();\r\n};\r\n\r\nSocket.onMessage = function(event) {\r\n    var message = JSON.parse(event.data);\r\n    var type = message.type;\r\n    var content = message.content;\r\n\r\n    if (type == 'conect') {\r\n        console.info(type);\r\n        WebRTC.createOffer();\r\n    } else if (type == 'join') {\r\n        console.info(type);\r\n    } else if (type == 'webrtc') {\r\n        console.info(type);\r\n        WebRTC.onMessage(content);\r\n    } else if (type == 'leave') {\r\n        console.info(type);\r\n        WebRTC.refresh();\r\n        Chat.log(Lang.get('log_leave'), true);\r\n    } else if (type == 'next') {\r\n        console.info(type);\r\n        Chat.log(Lang.get('log_next'), true);\r\n        Chat.log(Lang.get('log_search'));\r\n        WebRTC.refresh();\r\n    } else if (type == 'message') {\r\n        Chat.pushMesage(content);\r\n    } else {\r\n        console.warn('unknown message', type, content);\r\n    }\r\n};\r\n\r\nSocket.onClose = function(event) {\r\n    clearInterval(Chat.interval);\r\n    if (event.wasClean) {\r\n        Chat.log(Lang.get('log_clouse_conecting'), true);\r\n    } else {\r\n        Chat.log(Lang.get('log_clouse_disconected'), true);\r\n    }\r\n    Chat.stopStream();\r\n};\r\n\r\nSocket.onError = function(event) {\r\n    clearInterval(Chat.interval);\r\n    Chat.log(Lang.get('log_socket_error'), true);\r\n    console.warn('Socket ERROR:', event.data);\r\n};\r\n\r\nSocket.sendMessage = function(type, content, mute) {\r\n    if (this.ws && this.ws.readyState == 1) {\r\n        this.ws.send(JSON.stringify({\r\n            type: type,\r\n            content: content || false\r\n        }));\r\n    } else if (!mute) {\r\n        Chat.log(Lang.get('log_no_conection'));\r\n    }\r\n};\r\n","/* globals Socket, window, Chat, Resize, Lang*/\r\n\r\nvar WebRTC = {};\r\n\r\nWebRTC.constraints = {\r\n    audio: true,\r\n    video: true\r\n};\r\n\r\nWebRTC.create = function() {\r\n    window.PeerConnection =\r\n    window.PeerConnection ||\r\n    window.mozRTCPeerConnection ||\r\n    window.webkitRTCPeerConnection;\r\n\r\n    window.IceCandidate =\r\n    window.IceCandidate ||\r\n    window.mozRTCIceCandidate ||\r\n    window.RTCIceCandidate;\r\n\r\n    window.SessionDescription =\r\n    window.SessionDescription ||\r\n    window.mozRTCSessionDescription ||\r\n    window.RTCSessionDescription;\r\n\r\n    var servers = null;\r\n\r\n    this.pc = new window.PeerConnection(servers);\r\n    this.pc.addStream(this.localStream);\r\n    this.pc.onicecandidate = this.getIceCandidate.bind(this);\r\n    this.pc.onaddstream = this.getRemoteStream.bind(this);\r\n    Chat.remoteStream.classList.add('loading');\r\n};\r\n\r\nWebRTC.getMedia = function() {\r\n    navigator.getUserMedia = navigator.getUserMedia || navigator.mozGetUserMedia || navigator.webkitGetUserMedia;\r\n    navigator.getUserMedia(\r\n        WebRTC.constraints,\r\n        this.getLocalStream.bind(this),\r\n        this.streamError.bind(this)\r\n    );\r\n};\r\n\r\nWebRTC.getLocalStream = function(stream) {\r\n    Chat.clearHistory();\r\n    this.localStream = stream;\r\n    Socket.create();\r\n    WebRTC.create();\r\n    Chat.localVideo.src = URL.createObjectURL(stream);\r\n    Chat.localStream.classList.remove('camera-off');\r\n    this.getStream();\r\n};\r\n\r\nWebRTC.getRemoteStream = function(event) {\r\n    this.remoteStream = event.stream;\r\n    Chat.remoteVideo.src = URL.createObjectURL(event.stream);\r\n    Chat.remoteStream.classList.remove('loading');\r\n    Chat.clearHistory();\r\n    Chat.log(Lang.get('log_partner_conected'), true);\r\n    this.getStream();\r\n};\r\n\r\nWebRTC.getStream = function() {\r\n    setTimeout(Resize.video, 2000);\r\n};\r\n\r\nWebRTC.getError = function() {\r\n    Chat.log(Lang.get('log_webrtc_error'));\r\n};\r\n\r\nWebRTC.close = function() {\r\n    if (WebRTC.pc) {\r\n        WebRTC.pc.close();\r\n        WebRTC.pc = null;\r\n    }\r\n};\r\n\r\nWebRTC.refresh = function() {\r\n    WebRTC.close();\r\n    WebRTC.create();\r\n};\r\n\r\nWebRTC.gotLocalDescription = function(description) {\r\n    this.pc.setLocalDescription(description);\r\n    Socket.sendMessage('webrtc', description);\r\n};\r\n\r\nWebRTC.streamError = function() {\r\n    Chat.log(Lang.get('log_stream_error'));\r\n    console.warn('Stream error');\r\n};\r\n\r\nWebRTC.getIceCandidate = function(event) {\r\n    if (event.candidate) {\r\n        Socket.sendMessage('webrtc', {\r\n            type: 'candidate',\r\n            label: event.candidate.sdpMLineIndex,\r\n            id: event.candidate.sdpMid,\r\n            candidate: event.candidate.candidate\r\n        });\r\n    }\r\n};\r\n\r\nWebRTC.createOffer = function() {\r\n    this.pc.createOffer(\r\n        this.gotLocalDescription.bind(this),\r\n        this.getError,\r\n        { 'mandatory': { 'OfferToReceiveAudio': true, 'OfferToReceiveVideo': true } }\r\n    );\r\n};\r\n\r\nWebRTC.createAnswer = function() {\r\n    this.pc.createAnswer(\r\n        this.gotLocalDescription.bind(this),\r\n        this.getError,\r\n        { 'mandatory': { 'OfferToReceiveAudio': true, 'OfferToReceiveVideo': true } }\r\n    );\r\n};\r\n\r\nWebRTC.onMessage = function(message) {\r\n    if (message.type == 'offer') {\r\n        this.pc.setRemoteDescription(new window.SessionDescription(message));\r\n        WebRTC.createAnswer();\r\n    } else if (message.type == 'answer') {\r\n        this.pc.setRemoteDescription(new window.SessionDescription(message));\r\n    } else if (message.type == 'candidate') {\r\n        this.pc.addIceCandidate(new window.IceCandidate({sdpMLineIndex: message.label, candidate: message.candidate}));\r\n    }\r\n};\r\n"]}